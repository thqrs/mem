<!DOCTYPE html>
<html>
<head>
    <title>Memorization Aid with Tracking and Customization</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }
        
        #customizationPanel, #statsTable, #audioButtons, #autoplayControls {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }


        #waveformCanvas {
            display: block; /* Ensures the canvas is a block-level element */
            margin: 20px auto; /* Top and bottom margins of 20px, and auto left/right margins for centering */
            width: 600px; /* Set a specific width for the canvas */
            height: 100px; /* Height of the canvas */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Optional: Adds a shadow for better visibility */
        }




        
        audio {
            width: 100%;
            margin-top: 20px;
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            margin-right: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        th {
            background-color: #007bff;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        input[type=range] {
            width: 100%;
        }
        
        input[type=number], input[type=checkbox] {
            margin-top: 10px;
        }
        
        .dark-mode {
            background-color: #333;
            color: #fff;
        }
        
        .dark-mode button {
            background-color: #4CAF50;
        }
        
        .dark-mode button:hover {
            background-color: #367c39;
        }
        
        .dark-mode th {
            background-color: #4CAF50;
        }
        
        .dark-mode td, .dark-mode th {
            border-color: #555;
        }

        #currentDisplay {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode #currentDisplay {
            background-color: #4CAF50;
        }

    </style>
</head>
<body>

     <div id="audioButtons">
        <audio id="audioPlayer" controls></audio>
        <button id="prev">Previous</button>
        <button id="playNumber">Play Number</button>
        <button id="playKW">Play KW</button>
        <button id="playFull">Play Full</button>
        <button id="difficult">Difficult</button>
        <button id="next">Next</button>
    </div>
    
      <div id="autoplayControls">
        <label><input type="checkbox" id="autoplayNumber" checked> Autoplay Number</label>
        <label><input type="checkbox" id="autoplayKW" checked> Autoplay KW</label>
        <label><input type="checkbox" id="autoplayFull" checked> Autoplay Full</label>
        <button id="startAutoplay">Start Autoplay</button>
    </div>
    
    <canvas id="waveformCanvas"></canvas>
        
    <div id="customizationPanel">
        <label for="delayTime">Delay Time (seconds):</label>
        <input type="number" id="delayTime" value="5" min="1" max="10">

        <label for="themeToggle">Dark Mode:</label>
        <input type="checkbox" id="themeToggle">

        <label for="volumeControl">Volume:</label>
        <input type="range" id="volumeControl" min="0" max="100" value="100">
    </div>

    <div id="currentDisplay">
        <h2>Currently Playing: <span id="currentNumber">None</span></h2>
    </div>

    <table id="statsTable">
        <tr>
            <th>Number</th>
            <th>Keyword</th>
            <th>Difficult Count</th>
        </tr>
        <!-- Rows will be added dynamically -->
    </table>

    <script>
        var currentFileIndex = 0;
        var stats = [];
        var data = {}; // Object to hold items and naming convention
        var namingConvention = {};
        var delayAfterNumber = 5000; // Default delay time
        
        var player = document.getElementById('audioPlayer');
        var statsTable = document.getElementById('statsTable');
        
        // Load data from the JSON file
        fetch('memorization_data.json').then(response => response.json()).then(json => {
            data = json.items;
            namingConvention = json.namingConvention;
            initializeTable();
        });
        
        function initializeTable() {
            for (let i = 0; i < data.length; i++) {
                stats.push({ number: data[i].number, keyword: data[i].kwText, difficultCount: 0 });
                let row = statsTable.insertRow(-1);
                row.insertCell(0).textContent = stats[i].number;
                row.insertCell(1).textContent = stats[i].keyword;
                row.insertCell(2).textContent = stats[i].difficultCount;
            }
        }
        
        function getFilePath(template, number) {
            return template.replace('%d', number);
        }
        
        function updateCurrentNumberDisplay(number) {
            document.getElementById('currentNumber').textContent = number || 'None';
        }
        
        document.getElementById('playNumber').addEventListener('click', function() {
            player.src = getFilePath(namingConvention.numberAudio, data[currentFileIndex].number);
            player.play();
            updateCurrentNumberDisplay(data[currentFileIndex].number);
        });
        
        document.getElementById('playFull').addEventListener('click', function() {
            player.src = getFilePath(namingConvention.fullAudio, data[currentFileIndex].number);
            player.play();
            updateCurrentNumberDisplay('Full - ' + data[currentFileIndex].number);
        });
        
        document.getElementById('next').addEventListener('click', function() {
            moveToNext();
        });
        
        document.getElementById('difficult').addEventListener('click', function() {
            stats[currentFileIndex].difficultCount++;
            updateTable();
            moveToNext();
        });
        
        document.getElementById('delayTime').addEventListener('change', function() {
            delayAfterNumber = this.value * 1000;
        });
        
        document.getElementById('themeToggle').addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add("dark-mode");
            } else {
                document.body.classList.remove("dark-mode");
            }
        });
        
        document.getElementById('volumeControl').addEventListener('input', function() {
            player.volume = this.value / 100;
        });

        document.getElementById('prev').addEventListener('click', function() {
            moveToPrevious();
        });
        
        function moveToPrevious() {
            if (currentFileIndex > 0) {
                currentFileIndex--;
            } else {
                currentFileIndex = data.length - 1; // Loop back to the last item
            }
            player.src = getFilePath(namingConvention.numberAudio, data[currentFileIndex].number);
            player.play();
            updateCurrentNumberDisplay(data[currentFileIndex].number);
        }
        
        function moveToNext() {
            currentFileIndex = (currentFileIndex + 1) % data.length;
            player.src = getFilePath(namingConvention.numberAudio, data[currentFileIndex].number);
            player.play();
            updateCurrentNumberDisplay(data[currentFileIndex].number);
        }
        
        function updateTable() {
            statsTable.rows[currentFileIndex + 1].cells[2].textContent = stats[currentFileIndex].difficultCount;
        }



        // ... existing JavaScript ...

        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        var sourceNode = audioCtx.createMediaElementSource(player);
        var analyser = audioCtx.createAnalyser();
        
        sourceNode.connect(analyser);
        analyser.connect(audioCtx.destination);
        
        analyser.fftSize = 2048;
        var bufferLength = analyser.fftSize;
        var dataArray = new Uint8Array(bufferLength);
        
        var canvas = document.getElementById("waveformCanvas");
        var canvasCtx = canvas.getContext("2d");
        
        function drawWaveform() {
            requestAnimationFrame(drawWaveform);
        
            analyser.getByteTimeDomainData(dataArray);
        
            canvasCtx.fillStyle = "rgb(255, 255, 255)";
            canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
        
            canvasCtx.lineWidth = 2;
            canvasCtx.strokeStyle = "rgb(0, 0, 0)";
        
            canvasCtx.beginPath();
        
            var sliceWidth = canvas.width * 1.0 / bufferLength;
            var x = 0;
        
            for(var i = 0; i < bufferLength; i++) {
         
                var v = dataArray[i] / 128.0;
                var y = v * canvas.height / 2;
        
                if(i === 0) {
                    canvasCtx.moveTo(x, y);
                } else {
                    canvasCtx.lineTo(x, y);
                }
        
                x += sliceWidth;
            }
        
            canvasCtx.lineTo(canvas.width, canvas.height / 2);
            canvasCtx.stroke();
        }
        
        drawWaveform();
        
        // autoplay

        document.getElementById('playKW').addEventListener('click', function() {
            player.src = getFilePath(namingConvention.kwAudio, data[currentFileIndex].number);
            player.play();
            updateCurrentNumberDisplay('KW - ' + data[currentFileIndex].number);
        });
        
        var autoplayIndex = 0;
        var autoplayOrder = [];
        
        document.getElementById('startAutoplay').addEventListener('click', function() {
            autoplayIndex = 0;
            createAutoplayOrder();
            playAutoplaySequence();
        });
        
        function createAutoplayOrder() {
            autoplayOrder = [];
            for (let i = 0; i < data.length; i++) {
                if (document.getElementById('autoplayNumber').checked) {
                    autoplayOrder.push(getFilePath(namingConvention.numberAudio, data[i].number));
                }
                if (document.getElementById('autoplayKW').checked) {
                    autoplayOrder.push(getFilePath(namingConvention.kwAudio, data[i].number));
                }
                if (document.getElementById('autoplayFull').checked) {
                    autoplayOrder.push(getFilePath(namingConvention.fullAudio, data[i].number));
                }
            }
        }
        
        function playAutoplaySequence() {
            if (autoplayIndex < autoplayOrder.length) {
                player.src = autoplayOrder[autoplayIndex++];
                player.play().catch(error => {
                    console.error("Error playing file: ", player.src, error);
                    playAutoplaySequence();
                });
            }
        }
        
        player.addEventListener('ended', function() {
            if (autoplayIndex < autoplayOrder.length) {
                playAutoplaySequence();
            }
        });
        
        player.addEventListener('error', function(e) {
            console.error("Error loading file: ", player.src, e);
            playAutoplaySequence();
        });
        
        // ... existing JavaScript ...




    </script>

</body>
</html>
